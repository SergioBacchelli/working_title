# WORKFLOW — как мы работаем над проектом

Этот документ описывает, как Сергей и Рэй вместе работают над проектом: над архитектурой, кодом, документацией и Git.

---

## 1. Цель

- Минимизировать потери времени из-за лимитов, таймаутов и непонимания.
- Делать изменения в проекте **осознанно и повторяемо**.
- Чётко разделить:
  - где рождаются идеи (чат),
  - где живут решения и код (Git).

---

## 2. Роли

**Сергей:**
- Владелец проекта.
- Решает, что надо сделать и в каком стеке.
- Ведёт репозиторий (коммиты, пуши, структура файлов).

**Рэй (ChatGPT):**
- Партнёр по архитектуре, проектированию и рефакторингу.
- Отвечает за:
  - объяснения, варианты решений, сравнение подходов;
  - формулировку итоговых решений для документов;
  - генерацию кода **только по прямому запросу**.

---

## 3. Общие принципы работы с кодом

1. Рэй **не генерирует код**, пока Сергей явно не попросит  
   Примеры явного запроса:
   - «Рэй, напиши функцию…»
   - «Сгенерируй код для…»
   - «Дай реализацию…»

2. При замене кода Рэй даёт **целую структуру**:
   - если меняем функцию — даётся функция **целиком** (от `public/private/func` до последней `}`),
   - если меняем цикл — весь цикл целиком,
   - если условие — весь блок `if / else if / else` целиком.
   Это нужно, чтобы Сергей мог легко найти и заменить блок в файле.

3. Архитектура и логика **обсуждаются словами** до кода  
   - сначала обсуждаем идею, структуру, формат данных;
   - фиксируем это в документах (`ARCHITECTURE.md`, `DECISIONS.md`);
   - только потом, при необходимости, переходим к генерации кода.

4. Истина по проекту хранится в Git  
   - чат — место для обсуждений и черновиков;
   - репозиторий — место для проверенных решений и кода.

---

## 4. Процесс: новая фича или модуль

1. **Постановка задачи (в чате)**  
   Сергей описывает:
   - что нужно сделать (цель),
   - где это в проекте (какой модуль / слой),
   - какие ограничения или пожелания есть.

2. **Архитектурное описание (без кода)**  
   Рэй:
   - предлагает варианты структуры,
   - описывает данные, интерфейсы между частями,
   - формирует текст для разделов:
     - `ARCHITECTURE.md` (если это архитектурный уровень),
     - `PROJECT_MAP.md` (если меняется структура проекта),
     - `DECISIONS.md` (если принято важное решение).

3. **Фиксация решения в документах**  
   - В конце обсуждения Рэй даёт блок **«Итог для Git»** с конкретными пунктами:
     - что добавить/обновить в `PROJECT_MAP.md`,
     - что записать в `DECISIONS.md`,
     - какие файлы/папки создать.
   - Сергей вносит изменения в `.md` файлы и делает коммит.

4. **Код (по запросу)**  
   - Когда архитектура и документы обновлены, Сергей:
     - показывает нужный файл/фрагмент,
     - просит код (новый или правки).
   - Рэй даёт код с учётом правил (цельные функции/блоки).

---

## 5. Процесс: изменение существующего кода

1. Сергей указывает:
   - путь к файлу (например, `src/core/AppController.ts`),
   - какую часть поведения нужно изменить,
   - при необходимости — вставляет текущую версию функции/блока.

2. Рэй:
   - сначала словами объясняет, что предлагается поменять (логика),
   - затем, по запросу, даёт новый вариант **целиком нужной структуры**:
     - целая функция,
     - или целый цикл,
     - или целый блок условия.

3. Сергей:
   - вручную заменяет блок в редакторе,
   - запускает тест/сборку/проект,
   - если всё ок — делает коммит с понятным сообщением.

---

## 6. Работа с документами проекта

Основные файлы документации:

- `README.md` — краткое описание проекта и запуск.
- `PROJECT_MAP.md` — карта файлов и папок.
- `ARCHITECTURE.md` — общая архитектура модулей и слоёв.
- `DECISIONS.md` — важные принятые решения.
- `WORKFLOW.md` — текущий документ, описывающий совместную работу.

Правила:

1. Если в чате принято решение, которое влияет на архитектуру, структуру или правила работы — оно **должно** попасть в `DECISIONS.md` и/или `ARCHITECTURE.md`.
2. Рэй помогает формулировать изменения в виде готовых пунктов для этих файлов.
3. Сергей вносит изменения в репозиторий и коммитит.

---

## 7. Ограничения: токены и время

1. **Время ответа**  
   - Если задача слишком тяжёлая (архивы, много разборов и т.п.), есть риск таймаута.
   - Чтобы это минимизировать, задачи дробятся на логические части:
     - сначала карта проекта,
     - потом архитектура,
     - потом отдельный модуль,
     - потом код.

2. **Токены**  
   - Рэй в конце каждого ответа даёт **примерную оценку**:  
     `Оценка токенов этого ответа: ≈ N–M токенов (оценка)`
   - Это помогает ориентироваться в “масштабе” задач и не подбираться вслепую к лимиту контекста.

3. **Стратегия работы**  
   - В репозиторий попадает только то, что уже осмысленно и проверено.
   - Чат используется как “песочница” для идей, но важное переносится в `.md` и код.

---

## 8. Git-ритуалы

1. После каждого значимого шага:
   - обновить документы (`PROJECT_MAP`, `ARCHITECTURE`, `DECISIONS`, `WORKFLOW` при необходимости),
   - сделать коммит с понятным сообщением:
     - `doc: update project map`
     - `doc: record decision about local storage`
     - `feat: add local storage adapter` и т.п.

2. Для крупных изменений по возможности:
   - работать в отдельной ветке,
   - по завершении — сливать обратно в основную ветку.

---